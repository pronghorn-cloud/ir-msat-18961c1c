import{_ as Z,o as ee,a as n,c as o,b as e,t as i,n as w,g as v,f as z,v as R,p as B,w as L,F as k,r as A,O as te,e as $,d as c,k as le,N as ae}from"./index-DxPLqLYP.js";const se={class:"digitize-page"},ne={class:"page-header"},oe={key:1,class:"batch-form"},ie={class:"batch-name-field"},ue=["placeholder"],de={class:"file-select-area"},ce={key:0,class:"files-list"},re={class:"file-item-header"},pe={class:"file-item-name"},ve={class:"file-item-size"},_e=["onClick"],fe={class:"file-meta-grid"},me={class:"meta-field"},he={class:"appeal-lookup-wrapper"},ge=["onUpdate:modelValue","onInput"],ke={key:0,class:"lookup-results"},ye=["onMousedown"],be={class:"lookup-fn"},De={class:"lookup-meta"},Ce={key:1,class:"linked-appeal"},Fe=["onClick"],we={class:"meta-field"},ze=["onUpdate:modelValue"],Be={class:"meta-field"},Ae=["onUpdate:modelValue"],$e={key:1,class:"upload-progress-section"},Se={class:"upload-progress-bar-track"},Ue={class:"upload-progress-text"},Ne={key:2,class:"batch-actions"},xe=["disabled"],Re={class:"batches-section"},Le={key:0,class:"loading-state"},Te={key:1,class:"empty-state"},Ve={key:2,class:"batches-list"},Me=["onClick"],Ie={class:"batch-card-info"},Oe={class:"batch-card-name"},He={class:"batch-card-meta"},Ee={class:"batch-card-right"},Pe={class:"batch-doc-count"},qe={key:0,class:"batch-card-body"},Je={key:0,class:"loading-inline"},Ge={key:1,class:"batch-docs-table"},We={class:"doc-type-badge"},je=["onClick"],Ke={key:1,class:"muted"},Xe={key:2,class:"loading-inline"},Qe={__name:"DigitizeFiles",setup(Ye){const y=c([]),S=c(!0),b=c(""),T=c(!1),m=c(!1),D=c(""),d=c([]),_=c(!1),f=c(0),C=c(!1),h=c(null),g=c([]),U=c(!1);let V={};function N(a,t=!1){b.value=a,T.value=t,setTimeout(()=>{b.value=""},5e3)}function M(a){return a?new Date(a).toLocaleDateString():"â€”"}function I(a){return a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB"}function J(a){const t=Array.from(a.target.files);O(t)}function G(a){C.value=!1;const t=Array.from(a.dataTransfer.files);O(t)}function O(a){for(const t of a)d.value.push({file:t,appeal_file_number:"",document_date:"",category:"Historical",lookupResults:null,linkedAppeal:null})}function W(a){d.value.splice(a,1)}function j(a){const t=d.value[a];if(t.linkedAppeal=null,clearTimeout(V[a]),!t.appeal_file_number||t.appeal_file_number.trim().length<2){t.lookupResults=null;return}V[a]=setTimeout(async()=>{try{const l=await $.get(`/digitize/lookup-appeal?file_number=${encodeURIComponent(t.appeal_file_number.trim())}`);l.success&&(t.lookupResults=l.data)}catch{t.lookupResults=[]}},300)}function K(a,t){const l=d.value[a];l.linkedAppeal=t,l.appeal_file_number=t.file_number,l.lookupResults=null}function X(a){const t=d.value[a];t.linkedAppeal=null,t.appeal_file_number=""}async function Q(){var l;if(d.value.length===0||_.value)return;_.value=!0,f.value=0;const a=new FormData;a.append("batch_name",D.value.trim()||"");const t=d.value.map(s=>({appeal_file_number:s.appeal_file_number||"",document_date:s.document_date||"",category:s.category||"Historical"}));a.append("metadata",JSON.stringify(t));for(const s of d.value)a.append("files",s.file);try{const s=localStorage.getItem("msat_token"),u=$.defaults.baseURL,r=new XMLHttpRequest;r.open("POST",`${u}/digitize/batches`),r.setRequestHeader("Authorization",`Bearer ${s}`),r.upload.addEventListener("progress",p=>{p.lengthComputable&&(f.value=Math.round(p.loaded/p.total*100))});const P=await new Promise((p,x)=>{r.onload=()=>{try{const q=JSON.parse(r.responseText);r.status>=200&&r.status<300?p(q):x(q)}catch{x({message:"Upload failed"})}},r.onerror=()=>x({message:"Upload failed"}),r.send(a)});N(P.message);const F=(l=P.documents)==null?void 0:l.filter(p=>p.warning).map(p=>p.warning);(F==null?void 0:F.length)>0&&setTimeout(()=>N(`Warnings: ${F.join("; ")}`,!0),100),H(),m.value=!1,await E()}catch(s){N(s.message||"Failed to upload batch",!0)}finally{_.value=!1,f.value=0}}function H(){D.value="",d.value=[],f.value=0}async function Y(a){if(h.value===a.id){h.value=null,g.value=[];return}h.value=a.id,U.value=!0;try{const t=await $.get(`/digitize/batches/${a.id}`);t.success&&(g.value=t.documents||[])}catch{g.value=[]}finally{U.value=!1}}async function E(){S.value=!0;try{const a=await $.get("/digitize/batches");a.success&&(y.value=a.data)}catch{y.value=[]}finally{S.value=!1}}return ee(()=>{E()}),(a,t)=>(n(),o("div",se,[e("div",ne,[t[6]||(t[6]=e("div",null,[e("h1",null,"Digitize Historical Files"),e("p",null,"Bulk upload scanned documents and link them to appeal cases")],-1)),e("goa-button",{type:"primary",on_click:t[0]||(t[0]=l=>m.value=!m.value)},i(m.value?"Cancel":"New Batch"),33)]),b.value?(n(),o("div",{key:0,class:w(["feedback-banner",T.value?"feedback-error":"feedback-success"])},i(b.value),3)):v("",!0),m.value?(n(),o("div",oe,[t[14]||(t[14]=e("h2",null,"Create Digitization Batch",-1)),e("div",ie,[t[7]||(t[7]=e("label",null,"Batch Name",-1)),z(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[1]||(t[1]=l=>D.value=l),placeholder:"Batch â€” "+new Date().toLocaleDateString("en-CA")},null,8,ue),[[R,D.value]])]),e("div",de,[t[9]||(t[9]=e("label",null,[B("Select Files "),e("span",{class:"required"},"*")],-1)),e("div",{class:w(["file-drop-zone",{"drag-active":C.value}]),onClick:t[2]||(t[2]=l=>a.$refs.fileInput.click()),onDragover:t[3]||(t[3]=L(l=>C.value=!0,["prevent"])),onDragleave:t[4]||(t[4]=l=>C.value=!1),onDrop:t[5]||(t[5]=L(l=>G(l),["prevent"]))},[e("input",{type:"file",ref:"fileInput",multiple:"",onChange:J,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.tif,.tiff",style:{display:"none"}},null,544),t[8]||(t[8]=e("div",{class:"drop-zone-content"},[e("span",{class:"drop-icon"},"ðŸ“„"),e("span",null,"Click to select files or drag & drop here"),e("span",{class:"drop-hint"},"PDF, Word, Excel, JPG, PNG, TIFF â€” max 50MB each")],-1))],34)]),d.value.length>0?(n(),o("div",ce,[e("h3",null,i(d.value.length)+" File(s) Selected",1),(n(!0),o(k,null,A(d.value,(l,s)=>(n(),o("div",{key:s,class:"file-item"},[e("div",re,[e("span",pe,i(l.file.name),1),e("span",ve,i(I(l.file.size)),1),e("button",{class:"file-remove-btn",onClick:u=>W(s),title:"Remove"},"Ã—",8,_e)]),e("div",fe,[e("div",me,[t[10]||(t[10]=e("label",null,"Appeal File #",-1)),e("div",he,[z(e("input",{type:"text",class:"form-input","onUpdate:modelValue":u=>l.appeal_file_number=u,placeholder:"e.g. 01-001-25",onInput:u=>j(s)},null,40,ge),[[R,l.appeal_file_number]]),l.lookupResults&&l.lookupResults.length>0?(n(),o("div",ke,[(n(!0),o(k,null,A(l.lookupResults,u=>(n(),o("div",{key:u.id,class:"lookup-item",onMousedown:L(r=>K(s,u),["prevent"])},[e("span",be,i(u.file_number),1),e("span",De,i(u.settlement_name)+" â€” "+i(u.issue_type),1)],40,ye))),128))])):v("",!0),l.linkedAppeal?(n(),o("div",Ce,[B(i(l.linkedAppeal.file_number)+" â€” "+i(l.linkedAppeal.settlement_name)+" ",1),e("button",{class:"clear-link-btn",onClick:u=>X(s)},"Ã—",8,Fe)])):v("",!0)])]),e("div",we,[t[11]||(t[11]=e("label",null,"Document Date",-1)),z(e("input",{type:"date",class:"form-input","onUpdate:modelValue":u=>l.document_date=u},null,8,ze),[[R,l.document_date]])]),e("div",Be,[t[13]||(t[13]=e("label",null,"Category",-1)),z(e("select",{class:"form-input","onUpdate:modelValue":u=>l.category=u},[...t[12]||(t[12]=[ae('<option value="Historical" data-v-05d61cce>Historical</option><option value="Filing" data-v-05d61cce>Filing</option><option value="Submission" data-v-05d61cce>Submission</option><option value="Evidence" data-v-05d61cce>Evidence</option><option value="Decision" data-v-05d61cce>Decision</option><option value="Order" data-v-05d61cce>Order</option><option value="Correspondence" data-v-05d61cce>Correspondence</option><option value="Other" data-v-05d61cce>Other</option>',8)])],8,Ae),[[le,l.category]])])])]))),128))])):v("",!0),_.value?(n(),o("div",$e,[e("div",Se,[e("div",{class:"upload-progress-bar-fill",style:te({width:f.value+"%"})},null,4)]),e("span",Ue,"Uploading... "+i(f.value)+"%",1)])):v("",!0),d.value.length>0?(n(),o("div",Ne,[e("goa-button",{type:"primary",disabled:d.value.length===0||_.value,on_click:Q},i(_.value?"Uploading...":"Upload Batch"),41,xe),e("goa-button",{type:"tertiary",on_click:H},"Clear All",32)])):v("",!0)])):v("",!0),e("div",Re,[t[16]||(t[16]=e("h2",null,"Digitization Batches",-1)),S.value?(n(),o("div",Le,"Loading batches...")):y.value.length===0?(n(),o("div",Te,'No digitization batches yet. Click "New Batch" to start.')):(n(),o("div",Ve,[(n(!0),o(k,null,A(y.value,l=>(n(),o("div",{key:l.id,class:"batch-card"},[e("div",{class:"batch-card-header",onClick:s=>Y(l)},[e("div",Ie,[e("span",Oe,i(l.name),1),e("span",He,[B(i(M(l.created_at))+" ",1),l.created_by_name?(n(),o(k,{key:0},[B(" Â· "+i(l.created_by_name),1)],64)):v("",!0)])]),e("div",Ee,[e("span",{class:w(["batch-status-badge","batch-status-"+(l.status||"").toLowerCase().replace(/\s+/g,"-")])},i(l.status),3),e("span",Pe,i(l.processed_files)+"/"+i(l.total_files)+" files",1),e("span",{class:w(["batch-expand-icon",{"batch-expanded":h.value===l.id}])},"â–¼",2)])],8,Me),h.value===l.id?(n(),o("div",qe,[U.value?(n(),o("div",Je,"Loading documents...")):g.value.length>0?(n(),o("table",Ge,[t[15]||(t[15]=e("thead",null,[e("tr",null,[e("th",null,"File Name"),e("th",null,"Type"),e("th",null,"Appeal #"),e("th",null,"Doc Date"),e("th",null,"Category"),e("th",null,"Size")])],-1)),e("tbody",null,[(n(!0),o(k,null,A(g.value,s=>(n(),o("tr",{key:s.id},[e("td",null,i(s.original_name||s.file_name),1),e("td",null,[e("span",We,i((s.file_type||"").toUpperCase()),1)]),e("td",null,[s.appeal_file_number?(n(),o("span",{key:0,class:"appeal-link",onClick:u=>a.$router.push(`/appeals/${s.appeal_id}`)},i(s.appeal_file_number),9,je)):(n(),o("span",Ke,"Unlinked"))]),e("td",null,i(s.document_date?M(s.document_date):"â€”"),1),e("td",null,i(s.category||"â€”"),1),e("td",null,i(s.file_size?I(s.file_size):"â€”"),1)]))),128))])])):(n(),o("div",Xe,"No documents in this batch."))])):v("",!0)]))),128))]))])]))}},et=Z(Qe,[["__scopeId","data-v-05d61cce"]]);export{et as default};
//# sourceMappingURL=DigitizeFiles-B8KJfJNg.js.map
