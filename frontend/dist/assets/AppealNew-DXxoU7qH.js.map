{"version":3,"file":"AppealNew-DXxoU7qH.js","sources":["../../src/views/AppealNew.vue"],"sourcesContent":["<template>\n  <div class=\"appeal-new\">\n    <div class=\"page-header\">\n      <h1>New Appeal</h1>\n      <p>Create a new appeal case</p>\n    </div>\n\n    <goa-callout v-if=\"errorMsg\" type=\"emergency\" heading=\"Error\">\n      {{ errorMsg }}\n    </goa-callout>\n\n    <div class=\"form-container\">\n      <div class=\"form-grid\">\n        <!-- Settlement -->\n        <goa-form-item label=\"Settlement\" :error=\"errors.settlement_id\" class=\"form-field\">\n          <goa-dropdown\n            name=\"settlement\"\n            :value=\"form.settlement_id\"\n            @_change=\"(e) => form.settlement_id = e.detail.value\"\n            width=\"100%\"\n            placeholder=\"Select settlement\"\n          >\n            <goa-dropdown-item\n              v-for=\"s in settlements\"\n              :key=\"s.id\"\n              :value=\"s.id\"\n              :label=\"s.name\"\n            />\n          </goa-dropdown>\n        </goa-form-item>\n\n        <!-- Issue Type -->\n        <goa-form-item label=\"Issue Type\" :error=\"errors.issue_type\" class=\"form-field\">\n          <goa-dropdown\n            name=\"issue_type\"\n            :value=\"form.issue_type\"\n            @_change=\"(e) => form.issue_type = e.detail.value\"\n            width=\"100%\"\n            placeholder=\"Select issue type\"\n          >\n            <goa-dropdown-item\n              v-for=\"t in issueTypes\"\n              :key=\"t.code\"\n              :value=\"t.name\"\n              :label=\"t.name\"\n            />\n          </goa-dropdown>\n        </goa-form-item>\n\n        <!-- Assigned Staff -->\n        <goa-form-item label=\"Assigned Staff\" :error=\"errors.primary_staff\" class=\"form-field\">\n          <goa-dropdown\n            name=\"primary_staff\"\n            :value=\"form.primary_staff\"\n            @_change=\"(e) => form.primary_staff = e.detail.value\"\n            width=\"100%\"\n            placeholder=\"Select staff\"\n          >\n            <goa-dropdown-item\n              v-for=\"s in staffList\"\n              :key=\"s.id\"\n              :value=\"`${s.first_name} ${s.last_name}`\"\n              :label=\"`${s.first_name} ${s.last_name}`\"\n            />\n          </goa-dropdown>\n        </goa-form-item>\n      </div>\n\n      <!-- Appellant Search -->\n      <goa-form-item label=\"Appellant\" :error=\"errors.appellant_id\" class=\"form-field-full\">\n        <div class=\"client-search\">\n          <goa-input\n            name=\"client_search\"\n            :value=\"clientSearch\"\n            @_change=\"(e) => { clientSearch = e.detail.value; searchClients(); }\"\n            width=\"100%\"\n            placeholder=\"Search by name (min 2 characters)...\"\n          />\n          <div v-if=\"clientResults.length > 0 && !selectedClient\" class=\"search-results\">\n            <div\n              v-for=\"c in clientResults\"\n              :key=\"c.id\"\n              class=\"search-result-item\"\n              @click=\"selectClient(c)\"\n            >\n              <strong>{{ c.first_name }} {{ c.last_name }}</strong>\n              <span v-if=\"c.email\" class=\"client-detail\"> — {{ c.email }}</span>\n              <span v-if=\"c.settlement\" class=\"client-detail\"> | {{ c.settlement }}</span>\n            </div>\n          </div>\n          <div v-if=\"selectedClient\" class=\"selected-client\">\n            <span>{{ selectedClient.first_name }} {{ selectedClient.last_name }}</span>\n            <span v-if=\"selectedClient.email\"> — {{ selectedClient.email }}</span>\n            <goa-button type=\"tertiary\" size=\"compact\" @_click=\"clearClient\">\n              Clear\n            </goa-button>\n          </div>\n        </div>\n      </goa-form-item>\n\n      <!-- Description -->\n      <goa-form-item label=\"Description\" :error=\"errors.description\" class=\"form-field-full\">\n        <goa-textarea\n          name=\"description\"\n          :value=\"form.description\"\n          @_change=\"(e) => form.description = e.detail.value\"\n          width=\"100%\"\n          rows=\"4\"\n          placeholder=\"Describe the appeal...\"\n        />\n        <span class=\"char-count\">{{ (form.description || '').length }}/2000</span>\n      </goa-form-item>\n\n      <!-- Legal Description -->\n      <goa-form-item label=\"Legal Description (Optional)\" class=\"form-field-full\">\n        <goa-textarea\n          name=\"legal_description\"\n          :value=\"form.legal_description\"\n          @_change=\"(e) => form.legal_description = e.detail.value\"\n          width=\"100%\"\n          rows=\"2\"\n          placeholder=\"Legal land description...\"\n        />\n      </goa-form-item>\n\n      <!-- Actions -->\n      <div class=\"form-actions\">\n        <goa-button type=\"primary\" @_click=\"handleSubmit\" :disabled=\"saving\">\n          {{ saving ? 'Creating...' : 'Create Appeal' }}\n        </goa-button>\n        <goa-button type=\"tertiary\" @_click=\"$router.push('/appeals')\">\n          Cancel\n        </goa-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport api from '@/services/api.js';\n\nconst router = useRouter();\n\nconst settlements = ref([]);\nconst issueTypes = ref([]);\nconst staffList = ref([]);\nconst clientResults = ref([]);\nconst selectedClient = ref(null);\nconst clientSearch = ref('');\nconst saving = ref(false);\nconst errorMsg = ref('');\n\nlet searchTimeout = null;\n\nconst form = reactive({\n  settlement_id: '',\n  issue_type: '',\n  description: '',\n  legal_description: '',\n  primary_staff: '',\n  appellant_id: ''\n});\n\nconst errors = reactive({\n  settlement_id: '',\n  issue_type: '',\n  description: '',\n  primary_staff: '',\n  appellant_id: ''\n});\n\nasync function loadLookups() {\n  try {\n    const [settlementsRes, issueTypesRes, staffRes] = await Promise.all([\n      api.get('/lookups/settlements'),\n      api.get('/lookups/issue-types'),\n      api.get('/lookups/staff')\n    ]);\n    settlements.value = settlementsRes.data;\n    issueTypes.value = issueTypesRes.data;\n    staffList.value = staffRes.data;\n  } catch {\n    errorMsg.value = 'Failed to load form data';\n  }\n}\n\nfunction searchClients() {\n  if (searchTimeout) clearTimeout(searchTimeout);\n  if (clientSearch.value.length < 2) {\n    clientResults.value = [];\n    return;\n  }\n  searchTimeout = setTimeout(async () => {\n    try {\n      const response = await api.get(`/clients/search?q=${encodeURIComponent(clientSearch.value)}`);\n      clientResults.value = response.data;\n    } catch {\n      clientResults.value = [];\n    }\n  }, 300);\n}\n\nfunction selectClient(client) {\n  selectedClient.value = client;\n  form.appellant_id = client.id;\n  clientResults.value = [];\n  clientSearch.value = `${client.first_name} ${client.last_name}`;\n  errors.appellant_id = '';\n}\n\nfunction clearClient() {\n  selectedClient.value = null;\n  form.appellant_id = '';\n  clientSearch.value = '';\n  clientResults.value = [];\n}\n\nfunction validate() {\n  let valid = true;\n  errors.settlement_id = '';\n  errors.issue_type = '';\n  errors.description = '';\n  errors.primary_staff = '';\n  errors.appellant_id = '';\n\n  if (!form.settlement_id) { errors.settlement_id = 'Settlement is required'; valid = false; }\n  if (!form.issue_type) { errors.issue_type = 'Issue type is required'; valid = false; }\n  if (!form.description?.trim()) { errors.description = 'Description is required'; valid = false; }\n  if (form.description && form.description.length > 2000) { errors.description = 'Max 2000 characters'; valid = false; }\n  if (!form.primary_staff) { errors.primary_staff = 'Assigned staff is required'; valid = false; }\n  if (!form.appellant_id) { errors.appellant_id = 'Appellant is required'; valid = false; }\n\n  return valid;\n}\n\nasync function handleSubmit() {\n  if (!validate()) return;\n\n  saving.value = true;\n  errorMsg.value = '';\n\n  try {\n    const response = await api.post('/appeals', {\n      settlement_id: form.settlement_id,\n      issue_type: form.issue_type,\n      description: form.description.trim(),\n      legal_description: form.legal_description?.trim() || null,\n      primary_staff: form.primary_staff,\n      appellant_id: form.appellant_id\n    });\n\n    if (response.success) {\n      router.push(`/appeals/${response.appeal.id}`);\n    }\n  } catch (err) {\n    errorMsg.value = err.response?.data?.message || 'Failed to create appeal';\n  } finally {\n    saving.value = false;\n  }\n}\n\nonMounted(loadLookups);\n</script>\n\n<style scoped>\n.appeal-new {\n  padding: var(--goa-space-m) 0;\n}\n\n.page-header {\n  margin-bottom: var(--goa-space-xl);\n}\n\n.page-header h1 {\n  font-size: var(--goa-font-size-8, 1.75rem);\n  margin-bottom: var(--goa-space-xs);\n}\n\n.page-header p {\n  color: var(--goa-color-text-secondary, #666);\n}\n\n.form-container {\n  background: white;\n  border: 1px solid var(--goa-color-greyscale-200, #dcdcdc);\n  border-radius: var(--goa-border-radius-m, 4px);\n  padding: var(--goa-space-xl);\n  max-width: 800px;\n}\n\n.form-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n  gap: var(--goa-space-m);\n}\n\n.form-field-full {\n  margin-top: var(--goa-space-m);\n}\n\n.client-search {\n  position: relative;\n}\n\n.search-results {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  background: white;\n  border: 1px solid var(--goa-color-greyscale-200, #dcdcdc);\n  border-top: none;\n  border-radius: 0 0 4px 4px;\n  max-height: 200px;\n  overflow-y: auto;\n  z-index: 100;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n\n.search-result-item {\n  padding: var(--goa-space-s) var(--goa-space-m);\n  cursor: pointer;\n  border-bottom: 1px solid var(--goa-color-greyscale-100, #f1f1f1);\n}\n\n.search-result-item:hover {\n  background: var(--goa-color-greyscale-100, #f1f1f1);\n}\n\n.client-detail {\n  color: var(--goa-color-text-secondary, #666);\n  font-size: var(--goa-font-size-4, 0.875rem);\n}\n\n.selected-client {\n  display: flex;\n  align-items: center;\n  gap: var(--goa-space-s);\n  margin-top: var(--goa-space-xs);\n  padding: var(--goa-space-s);\n  background: var(--goa-color-greyscale-100, #f1f1f1);\n  border-radius: var(--goa-border-radius-s, 4px);\n}\n\n.char-count {\n  font-size: var(--goa-font-size-3, 0.8rem);\n  color: var(--goa-color-text-secondary, #666);\n  margin-top: var(--goa-space-2xs);\n}\n\n.form-actions {\n  margin-top: var(--goa-space-l);\n  display: flex;\n  gap: var(--goa-space-s);\n}\n</style>\n"],"names":["router","useRouter","settlements","ref","issueTypes","staffList","clientResults","selectedClient","clientSearch","saving","errorMsg","searchTimeout","form","reactive","errors","loadLookups","settlementsRes","issueTypesRes","staffRes","api","searchClients","response","selectClient","client","clearClient","validate","valid","_a","handleSubmit","err","_c","_b","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_toDisplayString","_hoisted_3","_hoisted_4","_cache","_Fragment","_renderList","s","t","_hoisted_15","_hoisted_17","c","$event","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_25","_hoisted_26","_hoisted_28","_hoisted_29","$router"],"mappings":"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"}