import{_ as J,o as W,a as s,c as n,b as e,f as g,v as M,j as Y,k as U,F as D,r as x,g as k,t as o,e as F,d as u,l as Z,u as ee,n as te,w as ae}from"./index-DxPLqLYP.js";const le={class:"documents-page"},se={class:"search-section"},ne={class:"search-bar"},oe={class:"filters-row"},ue={class:"filter-group"},ie=["value"],re={class:"filter-group"},ce=["value"],de={class:"filter-group"},pe=["value"],ve={class:"filter-group"},me={class:"filter-group"},fe={class:"filter-actions"},_e={key:0,class:"results-summary"},ge={key:0,class:"search-time"},he={class:"table-container"},ye={class:"docs-table"},be={key:0},ke={key:1},we={class:"doc-name"},Se={class:"file-icon"},Ce=["title"],De=["onClick"],xe={key:1,class:"muted"},Fe={class:"file-size"},Ae={class:"date-cell"},Le=["on_click"],Me={key:1,class:"pagination"},Ue=["disabled"],ze={class:"page-info"},Ie=["disabled"],Ve={__name:"DocumentSearch",setup(Be){const N=ee(),w=u([]),S=u(!0),r=u(0),d=u(20),i=u(0),A=u(0),h=u(""),C=u(""),p=u(""),v=u(""),m=u(""),f=u(""),_=u(""),z=u([]),I=u([]),V=u([]),$=Z(()=>h.value||p.value||v.value||m.value||f.value||_.value);async function R(){try{const l=await F.get("/documents/categories");l.success&&(z.value=l.data)}catch{}}async function j(){try{const l=await F.get("/documents/appeals");l.success&&(I.value=l.data)}catch{}}async function G(){try{const l=await F.get("/documents/settlements");l.success&&(V.value=l.data)}catch{}}async function y(){S.value=!0;const l=Date.now();try{const t=new URLSearchParams;t.set("limit",d.value),t.set("offset",i.value),C.value&&t.set("search",C.value),p.value&&t.set("category",p.value),v.value&&t.set("appeal_id",v.value),m.value&&t.set("settlement",m.value),f.value&&t.set("date_from",f.value),_.value&&t.set("date_to",_.value);const a=await F.get(`/documents?${t.toString()}`);a.success&&(w.value=a.data,r.value=a.total)}catch{w.value=[],r.value=0}finally{A.value=Date.now()-l,S.value=!1}}function c(){C.value=h.value.trim(),i.value=0,y()}function P(){h.value="",C.value="",p.value="",v.value="",m.value="",f.value="",_.value="",i.value=0,y()}function T(){i.value=Math.max(0,i.value-d.value),y()}function E(){i.value=i.value+d.value,y()}function O(l){N.push(`/appeals/${l}`)}async function K(l){try{if(!l.appeal_id)return;const t=localStorage.getItem("msat_token"),a=await fetch(`/api/appeals/${l.appeal_id}/documents/${l.id}/download`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Download failed");const L=await a.blob(),B=URL.createObjectURL(L),b=document.createElement("a");b.href=B,b.download=l.original_name||l.file_name,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(B)}catch{alert("Failed to download document")}}function X(l){return l?l<1024?l+" B":l<1048576?(l/1024).toFixed(1)+" KB":(l/1048576).toFixed(1)+" MB":"—"}function Q(l){return l?new Date(l).toLocaleDateString("en-CA"):"—"}function q(l){return l?l.length>60?l.substring(0,57)+"...":l:"—"}function H(l){return{pdf:"PDF",doc:"DOC",docx:"DOC",xls:"XLS",xlsx:"XLS",jpg:"IMG",jpeg:"IMG",png:"IMG",tif:"IMG",tiff:"IMG"}[l==null?void 0:l.toLowerCase()]||"FILE"}return W(()=>{R(),j(),G(),y()}),(l,t)=>(s(),n("div",le,[t[17]||(t[17]=e("div",{class:"page-header"},[e("h1",null,"Document Search"),e("p",null,"Search across all uploaded documents by keyword, category, or date")],-1)),e("div",se,[e("div",ne,[g(e("input",{type:"text",class:"search-input-large","onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),placeholder:"Search documents by name, description, category, appeal file number...",onKeyup:Y(c,["enter"])},null,544),[[M,h.value]]),e("goa-button",{type:"primary",size:"compact",on_click:c},"Search",32)]),e("div",oe,[e("div",ue,[t[7]||(t[7]=e("label",null,"Category",-1)),g(e("select",{class:"filter-input","onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a),onChange:c},[t[6]||(t[6]=e("option",{value:""},"All Categories",-1)),(s(!0),n(D,null,x(z.value,a=>(s(),n("option",{key:a,value:a},o(a),9,ie))),128))],544),[[U,p.value]])]),e("div",re,[t[9]||(t[9]=e("label",null,"Appeal",-1)),g(e("select",{class:"filter-input","onUpdate:modelValue":t[2]||(t[2]=a=>v.value=a),onChange:c},[t[8]||(t[8]=e("option",{value:""},"All Appeals",-1)),(s(!0),n(D,null,x(I.value,a=>(s(),n("option",{key:a.id,value:a.id},o(a.file_number),9,ce))),128))],544),[[U,v.value]])]),e("div",de,[t[11]||(t[11]=e("label",null,"Settlement",-1)),g(e("select",{class:"filter-input","onUpdate:modelValue":t[3]||(t[3]=a=>m.value=a),onChange:c},[t[10]||(t[10]=e("option",{value:""},"All Settlements",-1)),(s(!0),n(D,null,x(V.value,a=>(s(),n("option",{key:a,value:a},o(a),9,pe))),128))],544),[[U,m.value]])]),e("div",ve,[t[12]||(t[12]=e("label",null,"From",-1)),g(e("input",{type:"date",class:"filter-input","onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),onChange:c},null,544),[[M,f.value]])]),e("div",me,[t[13]||(t[13]=e("label",null,"To",-1)),g(e("input",{type:"date",class:"filter-input","onUpdate:modelValue":t[5]||(t[5]=a=>_.value=a),onChange:c},null,544),[[M,_.value]])]),e("div",fe,[$.value?(s(),n("goa-button",{key:0,type:"tertiary",size:"compact",on_click:P},"Clear Filters",32)):k("",!0)])])]),S.value?k("",!0):(s(),n("div",_e,[e("span",null,o(r.value)+" document"+o(r.value!==1?"s":"")+" found",1),A.value>0?(s(),n("span",ge,"("+o(A.value)+"ms)",1)):k("",!0)])),e("div",he,[e("table",ye,[t[16]||(t[16]=e("thead",null,[e("tr",null,[e("th",null,"File Name"),e("th",null,"Category"),e("th",null,"Appeal"),e("th",null,"Settlement"),e("th",null,"Size"),e("th",null,"Uploaded"),e("th",null,"Actions")])],-1)),e("tbody",null,[S.value?(s(),n("tr",be,[...t[14]||(t[14]=[e("td",{colspan:"7",class:"center-text"},"Searching documents...",-1)])])):w.value.length===0?(s(),n("tr",ke,[...t[15]||(t[15]=[e("td",{colspan:"7",class:"center-text"},"No documents found",-1)])])):k("",!0),(s(!0),n(D,null,x(w.value,a=>(s(),n("tr",{key:a.id},[e("td",we,[e("span",Se,o(H(a.file_type)),1),e("span",{title:a.original_name},o(q(a.original_name)),9,Ce)]),e("td",null,[e("span",{class:te(["category-badge","cat-"+(a.category||"other").toLowerCase()])},o(a.category||"N/A"),3)]),e("td",null,[a.appeal_file_number?(s(),n("a",{key:0,href:"#",class:"appeal-link",onClick:ae(L=>O(a.appeal_id),["prevent"])},o(a.appeal_file_number),9,De)):(s(),n("span",xe,"—"))]),e("td",null,o(a.settlement_name||"—"),1),e("td",Fe,o(X(a.file_size)),1),e("td",Ae,o(Q(a.created_at)),1),e("td",null,[e("goa-button",{type:"tertiary",size:"compact",on_click:L=>K(a)},"Download",40,Le)])]))),128))])])]),r.value>d.value?(s(),n("div",Me,[e("goa-button",{type:"tertiary",size:"compact",disabled:i.value===0,on_click:T},"Previous",40,Ue),e("span",ze,"Showing "+o(i.value+1)+"–"+o(Math.min(i.value+d.value,r.value))+" of "+o(r.value),1),e("goa-button",{type:"tertiary",size:"compact",disabled:i.value+d.value>=r.value,on_click:E},"Next",40,Ie)])):k("",!0)]))}},$e=J(Ve,[["__scopeId","data-v-d78add2b"]]);export{$e as default};
//# sourceMappingURL=DocumentSearch-CDQJjB-l.js.map
