import{_ as Q,o as R,a as i,c as r,b as e,t as n,g as v,f as $,k as W,F as N,r as T,w as A,v as X,p as P,e as y,d,l as V,i as z,n as I}from"./index-DxPLqLYP.js";const Y={class:"content-manager"},Z={key:0,type:"success",heading:"Success"},ee={key:1,type:"emergency",heading:"Error"},te={class:"actions-bar"},se={class:"filter-group"},oe=["value"],le={class:"table-container"},ae={class:"content-table"},ne={key:0},ie={key:1},re={class:"page-badge"},ue={class:"actions-cell"},de=["on_click"],ce=["on_click"],_e=["on_click"],pe={class:"modal-content"},ge={key:0,type:"emergency",heading:"Error"},ve=["error"],ye=["value","disabled"],be=["error"],he=["value","disabled"],fe={label:"Title"},me=["value"],ke={label:"Body"},we={class:"form-row"},Ce={label:"Sort Order"},Se=["value"],De={label:"Published"},xe=["checked"],Fe={class:"form-actions"},Me=["disabled"],Pe={class:"modal-content modal-small"},Ee={class:"form-actions"},Be={__name:"ContentManager",setup($e){const m=d([]),D=d(!0),c=d(""),_=d(""),k=d(""),w=d(!1),u=d(null),C=d(!1),b=d(""),x=d(!1),p=d(null),s=z({page_slug:"",section_key:"",title:"",body:"",is_published:!0,sort_order:0}),g=z({page_slug:"",section_key:""}),L=V(()=>[...new Set(m.value.map(t=>t.page_slug))].sort()),E=V(()=>k.value?m.value.filter(o=>o.page_slug===k.value):m.value);function U(o){return o?new Date(o).toLocaleDateString("en-CA",{year:"numeric",month:"short",day:"numeric"}):"—"}async function h(){var o,t;D.value=!0;try{const a=await y.get("/content");a.success&&(m.value=a.data)}catch(a){_.value=((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to load content"}finally{D.value=!1}}function F(){g.page_slug="",g.section_key="",b.value=""}function q(){u.value=null,s.page_slug="",s.section_key="",s.title="",s.body="",s.is_published=!0,s.sort_order=0,F(),c.value="",_.value="",w.value=!0}async function O(o){u.value=o,F(),c.value="",_.value="";try{const t=await y.get(`/content/${o.id}`);if(t.success){const a=t.data;s.page_slug=a.page_slug,s.section_key=a.section_key,s.title=a.title||"",s.body=a.body||"",s.is_published=a.is_published,s.sort_order=a.sort_order}}catch{s.page_slug=o.page_slug,s.section_key=o.section_key,s.title=o.title||"",s.body="",s.is_published=o.is_published,s.sort_order=o.sort_order}w.value=!0}function S(){w.value=!1,u.value=null}function K(){F();let o=!0;return!u.value&&!s.page_slug.trim()&&(g.page_slug="Page slug is required",o=!1),!u.value&&!s.section_key.trim()&&(g.section_key="Section key is required",o=!1),o}async function H(){var o,t;if(K()){C.value=!0,b.value="";try{u.value?(await y.put(`/content/${u.value.id}`,{title:s.title,body:s.body,is_published:s.is_published,sort_order:s.sort_order})).success&&(c.value="Content block updated",S(),await h()):(await y.post("/content",{page_slug:s.page_slug.trim(),section_key:s.section_key.trim(),title:s.title,body:s.body,is_published:s.is_published,sort_order:s.sort_order})).success&&(c.value="Content block created",S(),await h())}catch(a){b.value=((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||"Operation failed"}finally{C.value=!1}}}async function j(o){var t,a;c.value="",_.value="";try{(await y.put(`/content/${o.id}`,{is_published:!o.is_published})).success&&(c.value=o.is_published?"Content unpublished":"Content published",await h())}catch(f){_.value=((a=(t=f.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update status"}}function G(o){p.value=o,x.value=!0}function M(){p.value=null,x.value=!1}async function J(){var o,t;if(p.value){c.value="",_.value="";try{(await y.delete(`/content/${p.value.id}`)).success&&(c.value="Content block deleted",await h())}catch(a){_.value=((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to delete content"}finally{M()}}}return R(h),(o,t)=>{var a,f;return i(),r("div",Y,[t[17]||(t[17]=e("div",{class:"page-header"},[e("h1",null,"Content Management"),e("p",null,"Manage website pages and content blocks")],-1)),c.value?(i(),r("goa-callout",Z,n(c.value),1)):v("",!0),_.value?(i(),r("goa-callout",ee,n(_.value),1)):v("",!0),e("div",te,[e("goa-button",{type:"primary",on_click:q}," Add Content Block ",32),e("div",se,[t[8]||(t[8]=e("label",null,"Filter by page:",-1)),$(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),class:"page-filter"},[t[7]||(t[7]=e("option",{value:""},"All Pages",-1)),(i(!0),r(N,null,T(L.value,l=>(i(),r("option",{key:l,value:l},n(l),9,oe))),128))],512),[[W,k.value]])])]),e("div",le,[e("table",ae,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"Page"),e("th",null,"Section Key"),e("th",null,"Title"),e("th",null,"Status"),e("th",null,"Order"),e("th",null,"Updated"),e("th",null,"Actions")])],-1)),e("tbody",null,[D.value?(i(),r("tr",ne,[...t[9]||(t[9]=[e("td",{colspan:"7",class:"center-text"},"Loading content...",-1)])])):E.value.length===0?(i(),r("tr",ie,[...t[10]||(t[10]=[e("td",{colspan:"7",class:"center-text"},"No content blocks found",-1)])])):v("",!0),(i(!0),r(N,null,T(E.value,l=>(i(),r("tr",{key:l.id,class:I({"draft-row":!l.is_published})},[e("td",null,[e("span",re,n(l.page_slug),1)]),e("td",null,n(l.section_key),1),e("td",null,n(l.title||"—"),1),e("td",null,[e("span",{class:I(["status-badge",l.is_published?"status-published":"status-draft"])},n(l.is_published?"Published":"Draft"),3)]),e("td",null,n(l.sort_order),1),e("td",null,n(U(l.updated_at)),1),e("td",ue,[e("goa-button",{type:"tertiary",size:"compact",on_click:B=>O(l)}," Edit ",40,de),e("goa-button",{type:"tertiary",size:"compact",on_click:B=>j(l)},n(l.is_published?"Unpublish":"Publish"),41,ce),e("goa-button",{type:"tertiary",size:"compact",on_click:B=>G(l)}," Delete ",40,_e)])],2))),128))])])]),w.value?(i(),r("div",{key:2,class:"modal-overlay",onClick:A(S,["self"])},[e("div",pe,[e("h2",null,n(u.value?"Edit Content Block":"New Content Block"),1),b.value?(i(),r("goa-callout",ge,n(b.value),1)):v("",!0),e("goa-form-item",{label:"Page Slug",error:g.page_slug},[e("goa-input",{name:"page_slug",value:s.page_slug,on_change:t[1]||(t[1]=l=>s.page_slug=l.detail.value),width:"100%",placeholder:"e.g. home, about, contact",disabled:!!u.value},null,40,ye)],8,ve),e("goa-form-item",{label:"Section Key",error:g.section_key},[e("goa-input",{name:"section_key",value:s.section_key,on_change:t[2]||(t[2]=l=>s.section_key=l.detail.value),width:"100%",placeholder:"e.g. hero, mandate, info",disabled:!!u.value},null,40,he)],8,be),e("goa-form-item",fe,[e("goa-input",{name:"title",value:s.title,on_change:t[3]||(t[3]=l=>s.title=l.detail.value),width:"100%",placeholder:"Section heading (optional)"},null,40,me)]),e("goa-form-item",ke,[$(e("textarea",{class:"body-editor","onUpdate:modelValue":t[4]||(t[4]=l=>s.body=l),rows:"10",placeholder:"Content body (supports plain text or HTML)"},null,512),[[X,s.body]])]),e("div",we,[e("goa-form-item",Ce,[e("goa-input",{type:"number",name:"sort_order",value:String(s.sort_order),on_change:t[5]||(t[5]=l=>s.sort_order=Number(l.detail.value)),width:"100px"},null,40,Se)]),e("goa-form-item",De,[e("goa-checkbox",{name:"is_published",checked:s.is_published,on_change:t[6]||(t[6]=l=>s.is_published=l.detail.checked)},null,40,xe)])]),e("div",Fe,[e("goa-button",{type:"primary",on_click:H,disabled:C.value},n(C.value?"Saving...":u.value?"Save Changes":"Create"),41,Me),e("goa-button",{type:"tertiary",on_click:S}," Cancel ",32)])])])):v("",!0),x.value?(i(),r("div",{key:3,class:"modal-overlay",onClick:A(M,["self"])},[e("div",Pe,[t[15]||(t[15]=e("h2",null,"Delete Content Block",-1)),e("p",null,[t[12]||(t[12]=P("Are you sure you want to delete the content block ",-1)),e("strong",null,'"'+n((a=p.value)==null?void 0:a.section_key)+'"',1),t[13]||(t[13]=P(" from page ",-1)),e("strong",null,'"'+n((f=p.value)==null?void 0:f.page_slug)+'"',1),t[14]||(t[14]=P("?",-1))]),t[16]||(t[16]=e("p",{class:"warning-text"},"This action cannot be undone.",-1)),e("div",Ee,[e("goa-button",{type:"primary",on_click:J}," Delete ",32),e("goa-button",{type:"tertiary",on_click:M}," Cancel ",32)])])])):v("",!0)])}}},Te=Q(Be,[["__scopeId","data-v-80484a2a"]]);export{Te as default};
//# sourceMappingURL=ContentManager-tNPHPzJX.js.map
