import{_ as L,o as N,a as n,c as o,b as a,t as r,g as _,F as g,r as y,e as v,d as u,i as $,u as F}from"./index-DxPLqLYP.js";const I={class:"appeal-new"},B={key:0,type:"emergency",heading:"Error"},M={class:"form-container"},E={class:"form-grid"},V=["error"],z=["value"],O=["value","label"],P=["error"],U=["value"],j=["value","label"],G=["error"],H=["value"],J=["value","label"],K=["error"],Q={class:"client-search"},W=["value"],X={key:0,class:"search-results"},Y=["onClick"],Z={key:0,class:"client-detail"},ee={key:1,class:"client-detail"},te={key:1,class:"selected-client"},ae={key:0},se=["error"],le=["value"],ie={class:"char-count"},ne={label:"Legal Description (Optional)",class:"form-field-full"},oe=["value"],re={class:"form-actions"},de=["disabled"],ue={__name:"AppealNew",setup(pe){const S=F(),w=u([]),k=u([]),C=u([]),p=u([]),d=u(null),c=u(""),h=u(!1),m=u("");let b=null;const t=$({settlement_id:"",issue_type:"",description:"",legal_description:"",primary_staff:"",appellant_id:""}),i=$({settlement_id:"",issue_type:"",description:"",primary_staff:"",appellant_id:""});async function A(){try{const[l,s,e]=await Promise.all([v.get("/lookups/settlements"),v.get("/lookups/issue-types"),v.get("/lookups/staff")]);w.value=l.data,k.value=s.data,C.value=e.data}catch{m.value="Failed to load form data"}}function q(){if(b&&clearTimeout(b),c.value.length<2){p.value=[];return}b=setTimeout(async()=>{try{const l=await v.get(`/clients/search?q=${encodeURIComponent(c.value)}`);p.value=l.data}catch{p.value=[]}},300)}function R(l){d.value=l,t.appellant_id=l.id,p.value=[],c.value=`${l.first_name} ${l.last_name}`,i.appellant_id=""}function T(){d.value=null,t.appellant_id="",c.value="",p.value=[]}function x(){var s;let l=!0;return i.settlement_id="",i.issue_type="",i.description="",i.primary_staff="",i.appellant_id="",t.settlement_id||(i.settlement_id="Settlement is required",l=!1),t.issue_type||(i.issue_type="Issue type is required",l=!1),(s=t.description)!=null&&s.trim()||(i.description="Description is required",l=!1),t.description&&t.description.length>2e3&&(i.description="Max 2000 characters",l=!1),t.primary_staff||(i.primary_staff="Assigned staff is required",l=!1),t.appellant_id||(i.appellant_id="Appellant is required",l=!1),l}async function D(){var l,s,e;if(x()){h.value=!0,m.value="";try{const f=await v.post("/appeals",{settlement_id:t.settlement_id,issue_type:t.issue_type,description:t.description.trim(),legal_description:((l=t.legal_description)==null?void 0:l.trim())||null,primary_staff:t.primary_staff,appellant_id:t.appellant_id});f.success&&S.push(`/appeals/${f.appeal.id}`)}catch(f){m.value=((e=(s=f.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to create appeal"}finally{h.value=!1}}}return N(A),(l,s)=>(n(),o("div",I,[s[7]||(s[7]=a("div",{class:"page-header"},[a("h1",null,"New Appeal"),a("p",null,"Create a new appeal case")],-1)),m.value?(n(),o("goa-callout",B,r(m.value),1)):_("",!0),a("div",M,[a("div",E,[a("goa-form-item",{label:"Settlement",error:i.settlement_id,class:"form-field"},[a("goa-dropdown",{name:"settlement",value:t.settlement_id,on_change:s[0]||(s[0]=e=>t.settlement_id=e.detail.value),width:"100%",placeholder:"Select settlement"},[(n(!0),o(g,null,y(w.value,e=>(n(),o("goa-dropdown-item",{key:e.id,value:e.id,label:e.name},null,8,O))),128))],40,z)],8,V),a("goa-form-item",{label:"Issue Type",error:i.issue_type,class:"form-field"},[a("goa-dropdown",{name:"issue_type",value:t.issue_type,on_change:s[1]||(s[1]=e=>t.issue_type=e.detail.value),width:"100%",placeholder:"Select issue type"},[(n(!0),o(g,null,y(k.value,e=>(n(),o("goa-dropdown-item",{key:e.code,value:e.name,label:e.name},null,8,j))),128))],40,U)],8,P),a("goa-form-item",{label:"Assigned Staff",error:i.primary_staff,class:"form-field"},[a("goa-dropdown",{name:"primary_staff",value:t.primary_staff,on_change:s[2]||(s[2]=e=>t.primary_staff=e.detail.value),width:"100%",placeholder:"Select staff"},[(n(!0),o(g,null,y(C.value,e=>(n(),o("goa-dropdown-item",{key:e.id,value:`${e.first_name} ${e.last_name}`,label:`${e.first_name} ${e.last_name}`},null,8,J))),128))],40,H)],8,G)]),a("goa-form-item",{label:"Appellant",error:i.appellant_id,class:"form-field-full"},[a("div",Q,[a("goa-input",{name:"client_search",value:c.value,on_change:s[3]||(s[3]=e=>{c.value=e.detail.value,q()}),width:"100%",placeholder:"Search by name (min 2 characters)..."},null,40,W),p.value.length>0&&!d.value?(n(),o("div",X,[(n(!0),o(g,null,y(p.value,e=>(n(),o("div",{key:e.id,class:"search-result-item",onClick:f=>R(e)},[a("strong",null,r(e.first_name)+" "+r(e.last_name),1),e.email?(n(),o("span",Z," — "+r(e.email),1)):_("",!0),e.settlement?(n(),o("span",ee," | "+r(e.settlement),1)):_("",!0)],8,Y))),128))])):_("",!0),d.value?(n(),o("div",te,[a("span",null,r(d.value.first_name)+" "+r(d.value.last_name),1),d.value.email?(n(),o("span",ae," — "+r(d.value.email),1)):_("",!0),a("goa-button",{type:"tertiary",size:"compact",on_click:T}," Clear ",32)])):_("",!0)])],8,K),a("goa-form-item",{label:"Description",error:i.description,class:"form-field-full"},[a("goa-textarea",{name:"description",value:t.description,on_change:s[4]||(s[4]=e=>t.description=e.detail.value),width:"100%",rows:"4",placeholder:"Describe the appeal..."},null,40,le),a("span",ie,r((t.description||"").length)+"/2000",1)],8,se),a("goa-form-item",ne,[a("goa-textarea",{name:"legal_description",value:t.legal_description,on_change:s[5]||(s[5]=e=>t.legal_description=e.detail.value),width:"100%",rows:"2",placeholder:"Legal land description..."},null,40,oe)]),a("div",re,[a("goa-button",{type:"primary",on_click:D,disabled:h.value},r(h.value?"Creating...":"Create Appeal"),41,de),a("goa-button",{type:"tertiary",on_click:s[6]||(s[6]=e=>l.$router.push("/appeals"))}," Cancel ",32)])])]))}},_e=L(ue,[["__scopeId","data-v-565b612d"]]);export{_e as default};
//# sourceMappingURL=AppealNew-DXxoU7qH.js.map
